# type-sum

Внутри любой базы данных в некотором виде реализован анализатор типов
выражений. В этой задаче предлагается научить анализатор вычислять _сумму_ 
типов.

## Поддерживаемые типы данных

Будем поддерживать такие типы (с возможностью добавить в будущем что-то еще).
1. [`Decimal<I, F>`](type_sum/type/decimal.hpp) &mdash; дробное число с
   фиксированной точкой. `I` &mdash; длина целой части, `F` &mdash; длина
   дробной.
2. [`String<L, V>`](type_sum/type/string.hpp) &mdash; строка. `L` &mdash; длина
   строки, `V` &mdash; флаг того, является ли длина переменной (т.е. находится
   в пределах `0..L`).
3. [`T?`](type_sum/type/nullable.hpp) &mdash; _нуллабельная_ версия типа `T`
   (аналог `std::optional`).
4. [`T|U`](type_sum/type/union.hpp) &mdash; _составной_ тип, который может
   принимать значения `T` и `U` (аналог `std::variant`).

Считается, что опции составного типа не могут быть нуллабельными, т.е. `T|(U?)`
&mdash; некорректно, а `(T|U)?` допускается.

## Сумма типов

_Суммой_ типов `T` и `U` будем называть "минимальный" тип, который включает в
себя домены `T` и `U`.

Примеры:
* `Decimal<1, 2> + Decimal<2, 1> = Decimal<2, 2>`
* `String<0..10> + String<100> = String<0..100>`
* `Decimal<1, 2> + String<10> = Decimal<1, 2>|String<10>`
* `Decimal<1, 2>|String<10> + Decimal<2, 1>? = Decimal<2, 2>|String<10>?`

В конструкции `T|U` могут встречаться только _несовместимые_ типы, т.е. всегда
`Decimal + Decimal = Decimal` и `String + String = String`.

## Где нужны сумма типов и тип `T|U`?

1. При исполнении `union`
```sql
select 3.14
union
select "abc"
```
2. Как результат `coalesce()`
```sql
select
    coalesce(x, y)
from (
    select 3.14 as x, "abc" as y
)
```
3. В выражениях `case-when`
```sql
select
    case 2 + 2
        when 4 then 3.14
        else "abc"
    end
```

## Задача

Нужно реализовать функцию [`Sum()`](type_sum/sum/sum.hpp). Чем более гибким и
расширяемым получится решение, тем лучше. Можно представить, что помимо
`Decimal` и `String` в будущем также понадобятся дата/время и целочисленные
типы разной длины.
